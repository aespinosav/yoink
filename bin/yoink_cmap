#!/usr/bin/env python

from collections import OrderedDict

import matplotlib.pyplot as plt
plt.switch_backend('tkAgg')
from matplotlib.widgets import RadioButtons, Button
from mpl_toolkits.axes_grid1 import make_axes_locatable
#from matplotlib.gridspec import GridSpec

from yoink.widgets import ShutterCrop, DragableCmap
from yoink.data import test_img


class NothingWidget(object):
    active = False

    def set_visible(self, vis):
        pass


#import argparse
#parser = argparse.ArgumentParser(
#        description='Yoink colored data from an image')
#parser.add_argument('image')

#args = parser.parse_args()
#img_path = args.image


def make_axes(fig):
    nrow, ncol = shape = 3, 4
    img_ax = plt.subplot2grid(shape, (0, 0), colspan=ncol, rowspan=2)
    divider = make_axes_locatable(img_ax)
    cmap_ax = divider.append_axes('right', size='5%', pad=0.5)

    row = nrow - 1
    select_ax = plt.subplot2grid(shape, (row, 0))
    dump_ax = plt.subplot2grid(shape, (row, 1))
    lo_ax = plt.subplot2grid(shape, (row, 2))
    hi_ax = plt.subplot2grid(shape, (row, 3))
    return img_ax, cmap_ax, (select_ax, dump_ax, lo_ax, hi_ax)


fig = plt.figure()
img_ax, cmap_ax, (select_ax, dump_ax, lo_ax, hi_ax) = make_axes(fig)

#im = plt.imread(img_path)
im = test_img()

img_ax.imshow(im)
shutter_crop = ShutterCrop(img_ax)
cmap_img = DragableCmap(img_ax, cmap_ax, lo_ax, hi_ax, im)
dump_button = Button(dump_ax, 'Dump to file')


states = OrderedDict()
states['Do nothing'] = NothingWidget()
states['Crop Image'] = shutter_crop
states['Select Colorbar'] = cmap_img


def toggle_state(new_state):
    assert new_state in states
    for k in states:
        if k == new_state:
            continue
        states[k].active = False
        states[k].set_visible(False)
    states[new_state].active = True
    states[new_state].set_visible(True)
toggle_state(states.keys()[0])


select_radio = RadioButtons(select_ax, labels=states.keys(), active=0)
select_radio.on_clicked(toggle_state)

plt.show()
